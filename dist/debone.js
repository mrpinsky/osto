"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.tags = {
    bold: 'strong',
    italic: 'em',
    underline: 'u',
    superscript: 'sup',
    subscript: 'sub',
    strikethrough: 's',
};
function deboneText(bone, format) {
    if (format === void 0) { format = 'html'; }
    var retVal = bone.text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    if (format === 'html' && 'attributes' in bone) {
        var color = bone.attributes.color;
        var colorStyle = color ? "color: " + color + ";" : '';
        var background = bone.attributes.background;
        var backgroundStyle = background
            ? "background-color: " + background + ";"
            : '';
        if (colorStyle.length + backgroundStyle.length > 0) {
            retVal = "<span style=\"" + (colorStyle + backgroundStyle) + "\">" + retVal + "</span>";
        }
        for (var attribute in bone.attributes) {
            if (bone.attributes[attribute]) {
                if (attribute in exports.tags) {
                    var tag = exports.tags[attribute];
                    retVal = "<" + tag + ">" + retVal + "</" + tag + ">";
                }
                else if (attribute === 'script') {
                    var tag = exports.tags[bone.attributes.script + 'script'];
                    retVal = "<" + tag + ">" + retVal + "</" + tag + ">";
                }
                else if (attribute === 'link') {
                    retVal = "<a href=\"" + bone.attributes.link + "\">" + retVal + "</a>";
                }
            }
        }
    }
    return retVal;
}
exports.deboneText = deboneText;
function deboneHashtag(bone, format) {
    return deboneText({ type: 'text', text: "#" + bone.tag, attributes: bone.attributes }, format);
}
exports.deboneHashtag = deboneHashtag;
function deboneAtMention(bone, format) {
    return deboneText({ type: 'text', text: "@id:" + bone.id, attributes: bone.attributes }, format);
}
exports.deboneAtMention = deboneAtMention;
function deboneInline(bone, format) {
    switch (bone.type) {
        case 'text':
            return deboneText(bone, format);
        case 'hashtag':
            return deboneHashtag(bone, format);
        case 'at':
            return deboneAtMention(bone, format);
        default:
            (function (x) {
                throw new Error("Invalid inline bone: " + bone);
            })(bone);
    }
}
exports.deboneInline = deboneInline;
function deboneP(p, format) {
    var contents = p.contents
        .map(function (bone) { return deboneInline(bone, format); })
        .reduce(function (acc, curr) { return acc.concat(curr); });
    return format === 'html' ? "<p>" + contents + "</p>" : contents;
}
exports.deboneP = deboneP;
function deboneList(list, format) {
    var items = list.items.map(function (item, index) {
        var li = item.map(function (bone) { return deboneInline(bone, format); }).join('');
        if (format === 'html') {
            return "<li>" + li + "</li>";
        }
        else {
            return "  " + (list.list === 'ordered' ? index + '.' : '-') + " " + li;
        }
    });
    if (format === 'html') {
        var tag = list.list === 'ordered' ? 'ol' : 'ul';
        return "<" + tag + ">" + items.join('') + "</" + tag + ">";
    }
    else {
        return items.join('\n');
    }
}
exports.deboneList = deboneList;
function deboneImage(image, format) {
    return "IMAGE {image.ref}";
}
exports.deboneImage = deboneImage;
function debone(skeleton, format) {
    return skeleton
        .map(function (bone) {
        switch (bone.type) {
            case 'p':
                return deboneP(bone, format);
            case 'list':
                return deboneList(bone, format);
            case 'image':
                return deboneImage(bone, format);
            default:
                return (function (x) {
                    throw new Error("Invalid block bone: " + bone);
                })(bone);
        }
    })
        .join('');
}
exports.debone = debone;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LEVBQUUsTUFBYztJQUNqRSxNQUFNLENBQUMsbUJBQW1CLENBQUM7QUFDN0IsQ0FBQztBQUZELGtDQUVDO0FBRUQsZ0JBQXVCLFFBQWtCLEVBQUUsTUFBYztJQUN2RCxNQUFNLENBQUMsUUFBUTtTQUNaLEdBQUcsQ0FBQyxVQUFBLElBQUk7UUFDUCxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNsQixLQUFLLEdBQUc7Z0JBQ04sTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDL0IsS0FBSyxNQUFNO2dCQUNULE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ2xDLEtBQUssT0FBTztnQkFDVixNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztZQUNuQztnQkFDRSxNQUFNLENBQUMsQ0FBQyxVQUFDLENBQVE7b0JBQ2YsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBdUIsSUFBTSxDQUFDLENBQUM7Z0JBQ2pELENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2IsQ0FBQztJQUNILENBQUMsQ0FBQztTQUNELElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUNkLENBQUM7QUFqQkQsd0JBaUJDIiwiZmlsZSI6ImRlYm9uZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIElubGluZUJvbmUsXG4gIEF0TWVudGlvbkJvbmUsXG4gIEhhc2h0YWdCb25lLFxuICBUZXh0Qm9uZSxcbiAgUGFyYWdyYXBoQm9uZSxcbiAgTGlzdEJvbmUsXG4gIFRyZWxsaXNJbWFnZUJvbmUsXG4gIFNrZWxldG9uLFxufSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IHR5cGUgRm9ybWF0ID0gJ2h0bWwnIHwgJ3BsYWluJztcblxuZXhwb3J0IGNvbnN0IHRhZ3MgPSB7XG4gIGJvbGQ6ICdzdHJvbmcnLFxuICBpdGFsaWM6ICdlbScsXG4gIHVuZGVybGluZTogJ3UnLFxuICBzdXBlcnNjcmlwdDogJ3N1cCcsXG4gIHN1YnNjcmlwdDogJ3N1YicsXG4gIHN0cmlrZXRocm91Z2g6ICdzJyxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWJvbmVUZXh0KGJvbmU6IFRleHRCb25lLCBmb3JtYXQ6IEZvcm1hdCA9ICdodG1sJyk6IHN0cmluZyB7XG4gIGxldCByZXRWYWwgPSBib25lLnRleHRcbiAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKVxuICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JylcbiAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpXG4gICAgLnJlcGxhY2UoL1wiL2csICcmcXVvdDsnKVxuICAgIC5yZXBsYWNlKC8nL2csICcmIzM5OycpO1xuXG4gIGlmIChmb3JtYXQgPT09ICdodG1sJyAmJiAnYXR0cmlidXRlcycgaW4gYm9uZSkge1xuICAgIGNvbnN0IGNvbG9yID0gYm9uZS5hdHRyaWJ1dGVzLmNvbG9yO1xuICAgIGNvbnN0IGNvbG9yU3R5bGUgPSBjb2xvciA/IGBjb2xvcjogJHtjb2xvcn07YCA6ICcnO1xuICAgIGNvbnN0IGJhY2tncm91bmQgPSBib25lLmF0dHJpYnV0ZXMuYmFja2dyb3VuZDtcbiAgICBjb25zdCBiYWNrZ3JvdW5kU3R5bGUgPSBiYWNrZ3JvdW5kXG4gICAgICA/IGBiYWNrZ3JvdW5kLWNvbG9yOiAke2JhY2tncm91bmR9O2BcbiAgICAgIDogJyc7XG5cbiAgICBpZiAoY29sb3JTdHlsZS5sZW5ndGggKyBiYWNrZ3JvdW5kU3R5bGUubGVuZ3RoID4gMCkge1xuICAgICAgcmV0VmFsID0gYDxzcGFuIHN0eWxlPVwiJHtjb2xvclN0eWxlICsgYmFja2dyb3VuZFN0eWxlfVwiPiR7cmV0VmFsfTwvc3Bhbj5gO1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgYXR0cmlidXRlIGluIGJvbmUuYXR0cmlidXRlcykge1xuICAgICAgaWYgKGJvbmUuYXR0cmlidXRlc1thdHRyaWJ1dGVdKSB7XG4gICAgICAgIGlmIChhdHRyaWJ1dGUgaW4gdGFncykge1xuICAgICAgICAgIGNvbnN0IHRhZyA9IHRhZ3NbYXR0cmlidXRlXTtcbiAgICAgICAgICByZXRWYWwgPSBgPCR7dGFnfT4ke3JldFZhbH08LyR7dGFnfT5gO1xuICAgICAgICB9IGVsc2UgaWYgKGF0dHJpYnV0ZSA9PT0gJ3NjcmlwdCcpIHtcbiAgICAgICAgICBjb25zdCB0YWcgPSB0YWdzW2JvbmUuYXR0cmlidXRlcy5zY3JpcHQgKyAnc2NyaXB0J107XG4gICAgICAgICAgcmV0VmFsID0gYDwke3RhZ30+JHtyZXRWYWx9PC8ke3RhZ30+YDtcbiAgICAgICAgfSBlbHNlIGlmIChhdHRyaWJ1dGUgPT09ICdsaW5rJykge1xuICAgICAgICAgIHJldFZhbCA9IGA8YSBocmVmPVwiJHtib25lLmF0dHJpYnV0ZXMubGlua31cIj4ke3JldFZhbH08L2E+YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXRWYWw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWJvbmVIYXNodGFnKGJvbmU6IEhhc2h0YWdCb25lLCBmb3JtYXQ6IEZvcm1hdCk6IHN0cmluZyB7XG4gIHJldHVybiBkZWJvbmVUZXh0KFxuICAgIHsgdHlwZTogJ3RleHQnLCB0ZXh0OiBgIyR7Ym9uZS50YWd9YCwgYXR0cmlidXRlczogYm9uZS5hdHRyaWJ1dGVzIH0sXG4gICAgZm9ybWF0LFxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVib25lQXRNZW50aW9uKGJvbmU6IEF0TWVudGlvbkJvbmUsIGZvcm1hdDogRm9ybWF0KTogc3RyaW5nIHtcbiAgcmV0dXJuIGRlYm9uZVRleHQoXG4gICAgeyB0eXBlOiAndGV4dCcsIHRleHQ6IGBAaWQ6JHtib25lLmlkfWAsIGF0dHJpYnV0ZXM6IGJvbmUuYXR0cmlidXRlcyB9LFxuICAgIGZvcm1hdCxcbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlYm9uZUlubGluZShib25lOiBJbmxpbmVCb25lLCBmb3JtYXQ6IEZvcm1hdCk6IHN0cmluZyB7XG4gIHN3aXRjaCAoYm9uZS50eXBlKSB7XG4gICAgY2FzZSAndGV4dCc6XG4gICAgICByZXR1cm4gZGVib25lVGV4dChib25lLCBmb3JtYXQpO1xuICAgIGNhc2UgJ2hhc2h0YWcnOlxuICAgICAgcmV0dXJuIGRlYm9uZUhhc2h0YWcoYm9uZSwgZm9ybWF0KTtcbiAgICBjYXNlICdhdCc6XG4gICAgICByZXR1cm4gZGVib25lQXRNZW50aW9uKGJvbmUsIGZvcm1hdCk7XG4gICAgZGVmYXVsdDpcbiAgICAgICgoeDogbmV2ZXIpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGlubGluZSBib25lOiAke2JvbmV9YCk7XG4gICAgICB9KShib25lKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVib25lUChwOiBQYXJhZ3JhcGhCb25lLCBmb3JtYXQ6IEZvcm1hdCk6IHN0cmluZyB7XG4gIGNvbnN0IGNvbnRlbnRzID0gcC5jb250ZW50c1xuICAgIC5tYXAoYm9uZSA9PiBkZWJvbmVJbmxpbmUoYm9uZSwgZm9ybWF0KSlcbiAgICAucmVkdWNlKChhY2M6IHN0cmluZywgY3Vycjogc3RyaW5nKSA9PiBhY2MuY29uY2F0KGN1cnIpKTtcblxuICByZXR1cm4gZm9ybWF0ID09PSAnaHRtbCcgPyBgPHA+JHtjb250ZW50c308L3A+YCA6IGNvbnRlbnRzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVib25lTGlzdChsaXN0OiBMaXN0Qm9uZSwgZm9ybWF0OiBGb3JtYXQpOiBzdHJpbmcge1xuICBsZXQgaXRlbXM6IHN0cmluZ1tdID0gbGlzdC5pdGVtcy5tYXAoKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgY29uc3QgbGkgPSBpdGVtLm1hcChib25lID0+IGRlYm9uZUlubGluZShib25lLCBmb3JtYXQpKS5qb2luKCcnKTtcblxuICAgIGlmIChmb3JtYXQgPT09ICdodG1sJykge1xuICAgICAgcmV0dXJuIGA8bGk+JHtsaX08L2xpPmA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgICAke2xpc3QubGlzdCA9PT0gJ29yZGVyZWQnID8gaW5kZXggKyAnLicgOiAnLSd9ICR7bGl9YDtcbiAgICB9XG4gIH0pO1xuXG4gIGlmIChmb3JtYXQgPT09ICdodG1sJykge1xuICAgIGNvbnN0IHRhZyA9IGxpc3QubGlzdCA9PT0gJ29yZGVyZWQnID8gJ29sJyA6ICd1bCc7XG4gICAgcmV0dXJuIGA8JHt0YWd9PiR7aXRlbXMuam9pbignJyl9PC8ke3RhZ30+YDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gaXRlbXMuam9pbignXFxuJyk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlYm9uZUltYWdlKGltYWdlOiBUcmVsbGlzSW1hZ2VCb25lLCBmb3JtYXQ6IEZvcm1hdCk6IHN0cmluZyB7XG4gIHJldHVybiBgSU1BR0Uge2ltYWdlLnJlZn1gO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVib25lKHNrZWxldG9uOiBTa2VsZXRvbiwgZm9ybWF0OiBGb3JtYXQpOiBzdHJpbmcge1xuICByZXR1cm4gc2tlbGV0b25cbiAgICAubWFwKGJvbmUgPT4ge1xuICAgICAgc3dpdGNoIChib25lLnR5cGUpIHtcbiAgICAgICAgY2FzZSAncCc6XG4gICAgICAgICAgcmV0dXJuIGRlYm9uZVAoYm9uZSwgZm9ybWF0KTtcbiAgICAgICAgY2FzZSAnbGlzdCc6XG4gICAgICAgICAgcmV0dXJuIGRlYm9uZUxpc3QoYm9uZSwgZm9ybWF0KTtcbiAgICAgICAgY2FzZSAnaW1hZ2UnOlxuICAgICAgICAgIHJldHVybiBkZWJvbmVJbWFnZShib25lLCBmb3JtYXQpO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiAoKHg6IG5ldmVyKSA9PiB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgYmxvY2sgYm9uZTogJHtib25lfWApO1xuICAgICAgICAgIH0pKGJvbmUpO1xuICAgICAgfVxuICAgIH0pXG4gICAgLmpvaW4oJycpO1xufVxuIl19
